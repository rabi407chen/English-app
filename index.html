<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563eb">
    <title>AI è‹±æ–‡å…¨èƒ½åŠ©æ‰‹</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    
    <style>
        /* (é€™è£¡ä¿ç•™åŸæœ¬ V6.0 çš„æ‰€æœ‰ CSS æ¨£å¼ï¼Œç‚ºäº†ç‰ˆé¢æ•´æ½”ï¼Œæˆ‘çœç•¥ CSS å…§å®¹ï¼Œè«‹ç›´æ¥ä½¿ç”¨ V6.0 çš„ CSS) */
        :root { --primary: #2563eb; --primary-hover: #1d4ed8; --secondary: #f3f4f6; --text-dark: #1f2937; --text-gray: #6b7280; --success: #10b981; --danger: #ef4444; --warning: #f59e0b; }
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background-color: #f8fafc; color: var(--text-dark); margin: 0; padding: 0; line-height: 1.6; user-select: none; -webkit-user-select: none; }
        header { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 1rem 2rem; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.25rem; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 0.5rem; }
        .nav-btn { background: var(--secondary); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600; color: var(--text-dark); transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; }
        .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 2rem; margin-bottom: 2rem; text-align: center; }
        .upload-area { border: 2px dashed #cbd5e1; border-radius: 0.75rem; padding: 2rem; transition: border-color 0.2s; cursor: pointer; position: relative; }
        .upload-area:hover { border-color: var(--primary); }
        input[type="file"] { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }
        .controls { margin-top: 1.5rem; display: flex; justify-content: center; gap: 1rem; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; background: var(--secondary); padding: 0.5rem 1rem; border-radius: 2rem; }
        #result-container { text-align: left; font-size: 1.1rem; line-height: 2; color: #374151; display: none; user-select: text; -webkit-user-select: text; }
        .paragraph { margin-bottom: 1.5rem; text-align: justify; text-indent: 2rem; }
        .word { cursor: pointer; border-bottom: 1px dotted transparent; transition: all 0.2s; }
        .word:hover { background-color: #eff6ff; color: var(--primary); border-bottom-color: var(--primary); }
        .drawer { position: fixed; top: 0; right: -400px; width: 350px; height: 100vh; background: white; box-shadow: -4px 0 15px rgba(0,0,0,0.1); transition: right 0.3s ease; z-index: 200; display: flex; flex-direction: column; }
        .drawer.open { right: 0; }
        .drawer-header { padding: 1.5rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: var(--primary); color: white; }
        .drawer-content { flex: 1; overflow-y: auto; padding: 1rem; }
        .vocab-item { background: var(--secondary); padding: 1rem; border-radius: 0.5rem; margin-bottom: 0.75rem; position: relative; }
        .vocab-word { font-weight: bold; color: var(--primary); font-size: 1.1em; }
        .vocab-mean { font-size: 0.9em; color: var(--text-dark); margin-top: 0.25rem; }
        .delete-btn { position: absolute; top: 0.5rem; right: 0.5rem; color: #9ca3af; cursor: pointer; font-size: 1.2rem; }
        .drawer-footer { padding: 1rem; border-top: 1px solid #e5e7eb; }
        .action-btn { width: 100%; padding: 0.75rem; border: none; border-radius: 0.5rem; font-weight: bold; cursor: pointer; margin-bottom: 0.5rem; transition: background 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: white; border: 1px solid #d1d5db; color: var(--text-dark); }
        .btn-success { background: var(--success); color: white; }
        #quiz-card { display: none; text-align: center; }
        .quiz-question { font-size: 2rem; font-weight: bold; color: var(--primary); margin-bottom: 2rem; }
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
        .quiz-btn { padding: 1.5rem; font-size: 1.1rem; background: white; border: 2px solid #e5e7eb; border-radius: 0.75rem; cursor: pointer; transition: all 0.2s; color: var(--text-dark); }
        .quiz-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .quiz-btn.wrong { background: var(--danger); color: white; border-color: var(--danger); }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 300; backdrop-filter: blur(2px); }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 500px; position: relative; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .close-modal { position: absolute; top: 1rem; right: 1.5rem; font-size: 1.5rem; cursor: pointer; color: #9ca3af; }
        .debug-img { max-width: 45%; border: 1px solid #ddd; margin: 5px; border-radius: 4px; }
        @media (max-width: 600px) { .drawer { width: 100%; right: -100%; } .quiz-options { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header>
        <div class="logo"><span onclick="goHome()" style="cursor:pointer;">ğŸ“š AI è‹±æ–‡å…¨èƒ½åŠ©æ‰‹</span></div>
        <button class="nav-btn" onclick="toggleDrawer()"><span>ğŸ“–</span> å–®å­—æœ¬ (<span id="vocab-count">0</span>)</button>
    </header>

    <div class="container">
        <div id="quiz-card" class="card">
            <h3 style="color:var(--text-gray); margin-bottom:0.5rem;">ğŸ§  å–®å­—éš¨å ‚æ¸¬é©—</h3>
            <div class="quiz-score">Score: <span id="current-score">0</span> / <span id="total-questions">0</span></div>
            <div id="quiz-game-area">
                <div class="quiz-question" id="quiz-word">Loading...</div>
                <div class="quiz-options" id="quiz-options"></div>
            </div>
            <div id="quiz-result-area" style="display:none;">
                <h2 id="final-score-title" style="font-size:2.5rem; margin:1rem 0;">100åˆ†!</h2>
                <p id="final-comment">å¤ªå²å®³äº†ï¼å…¨éƒ¨ç­”å°ï¼</p>
                <button class="action-btn btn-primary" onclick="startQuiz()" style="width:200px; margin:auto;">ğŸ”„ å†æ¸¬ä¸€æ¬¡</button><br><br>
                <button class="action-btn btn-outline" onclick="goHome()" style="width:200px; margin:auto;">ğŸ  å›åˆ°é¦–é </button>
            </div>
            <button id="quit-quiz-btn" class="action-btn btn-outline" onclick="goHome()" style="width:auto; margin-top:1rem;">âŒ çµæŸæ¸¬é©—</button>
        </div>

        <div id="upload-card" class="card">
            <div class="upload-area">
                <div style="font-size: 2rem;">ğŸ“·</div>
                <h3 style="margin: 0.5rem 0;">é»æ“Šä¸Šå‚³åœ–ç‰‡ æˆ– æ‹–æ›³æª”æ¡ˆè‡³æ­¤</h3>
                <p style="color: var(--text-gray); font-size: 0.9rem;">æ”¯æ´ jpg, png</p>
                <input type="file" id="imageInput" accept="image/*">
            </div>
            <div class="controls">
                <label class="checkbox-wrapper"><input type="checkbox" id="twoColumnMode" checked> <span>é›™æ¬„æ¨¡å¼</span></label>
            </div>
            <div id="status"></div>
            <div id="debug-area" style="display:none; margin-top:1rem; padding:1rem; background:#fff1f2; border-radius:0.5rem;">
                <p style="color: var(--danger); font-size:0.9rem; margin:0 0 0.5rem 0;">ğŸ”´ åˆ‡åœ–æª¢æŸ¥</p>
                <div id="debug-images-container"></div>
            </div>
        </div>

        <div id="result-card" class="card" style="display: none;"><div id="result-container"></div></div>
    </div>

    <div id="drawer" class="drawer">
        <div class="drawer-header"><h3 style="margin:0;">ğŸ“– æˆ‘çš„å–®å­—æœ¬</h3><span style="cursor:pointer; font-size:1.5rem;" onclick="toggleDrawer()">&times;</span></div>
        <div class="drawer-content" id="vocab-list"><div style="text-align:center; color:gray; margin-top:2rem;">ç›®å‰æ²’æœ‰æ”¶è—çš„å–®å­—</div></div>
        <div class="drawer-footer">
            <button class="action-btn btn-success" onclick="startQuiz()">ğŸ“ é–‹å§‹å–®å­—æ¸¬é©—</button>
            <button class="action-btn btn-primary" onclick="exportToCSV()">ğŸ“¤ åŒ¯å‡º CSV</button>
            <button class="action-btn btn-outline" onclick="clearVocab()" style="color:var(--danger); border-color:var(--danger);">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>
    </div>

    <div id="modal"><div class="modal-content"><span class="close-modal" onclick="closeModal()">&times;</span><div id="modal-body">è¼‰å…¥ä¸­...</div></div></div>

    <script>
        // (é€™è£¡è«‹å®Œæ•´ä¿ç•™ V6.0 çš„ JavaScript é‚è¼¯)
        const API_KEY = 'K87721920188957'; 
        let savedVocab = JSON.parse(localStorage.getItem('myVocab') || '[]'); 
        let quizQuestions = []; let currentQuestionIndex = 0; let score = 0; let isAnswering = false;
        
        const imageInput = document.getElementById('imageInput');
        const status = document.getElementById('status');
        const uploadCard = document.getElementById('upload-card');
        const resultCard = document.getElementById('result-card');
        const quizCard = document.getElementById('quiz-card');
        const resultContainer = document.getElementById('result-container');
        const twoColumnMode = document.getElementById('twoColumnMode');
        const debugArea = document.getElementById('debug-area');
        const debugImagesContainer = document.getElementById('debug-images-container');
        const modal = document.getElementById('modal');
        const modalBody = document.getElementById('modal-body');
        const drawer = document.getElementById('drawer');
        const vocabList = document.getElementById('vocab-list');
        const vocabCount = document.getElementById('vocab-count');

        updateVocabUI();

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0]; if (!file) return; resetUI();
            if (twoColumnMode.checked) processTwoColumns(file); else performCloudOCR(file);
        });
        function resetUI() { debugArea.style.display = 'none'; debugImagesContainer.innerHTML = ''; resultCard.style.display = 'none'; resultContainer.innerHTML = ''; updateStatus("æº–å‚™ä¸­...", "var(--text-gray)"); }
        function goHome() { quizCard.style.display = 'none'; uploadCard.style.display = 'block'; if(resultContainer.innerHTML !== '') resultCard.style.display = 'block'; drawer.classList.remove('open'); }
        async function processTwoColumns(file) { updateStatus("âš¡ æ­£åœ¨è™•ç†åœ–ç‰‡ç‰ˆé¢...", "var(--primary)"); try { const img = await loadImage(file); const leftBlob = await cropImage(img, 0, 0, 0.5, 1); const rightBlob = await cropImage(img, 0.5, 0, 0.5, 1); debugArea.style.display = 'block'; showDebugImage(leftBlob, "å·¦æ¬„åˆ‡åœ–"); showDebugImage(rightBlob, "å³æ¬„åˆ‡åœ–"); updateStatus("ğŸ” æ­£åœ¨è¾¨è­˜å·¦æ¬„æ–‡å­—...", "var(--warning)"); const leftText = await callOCRSpace(leftBlob); updateStatus("ğŸ” æ­£åœ¨è¾¨è­˜å³æ¬„æ–‡å­—...", "var(--warning)"); const rightText = await callOCRSpace(rightBlob); const fullText = (leftText || "") + "\n\n" + (rightText || ""); if (fullText.trim().length > 0) { updateStatus("âœ… è¾¨è­˜å®Œæˆï¼", "var(--success)"); displayInteractiveText(fullText); } else { updateStatus("âŒ è¾¨è­˜å¤±æ•—ï¼Œè«‹ç¢ºèªåœ–ç‰‡æ˜¯å¦æ¸…æ™°ã€‚", "var(--danger)"); } } catch (error) { console.error(error); updateStatus("âŒ ç³»çµ±éŒ¯èª¤: " + error.message, "var(--danger)"); } }
        async function performCloudOCR(file) { updateStatus("â˜ï¸ æ­£åœ¨ä¸Šå‚³è‡³é›²ç«¯è¾¨è­˜...", "var(--primary)"); const text = await callOCRSpace(file); if (text) { updateStatus("âœ… è¾¨è­˜æˆåŠŸ", "var(--success)"); displayInteractiveText(text); } else { updateStatus("âŒ è¾¨è­˜å¤±æ•—", "var(--danger)"); } }
        async function callOCRSpace(fileBlob) { const formData = new FormData(); formData.append("apikey", API_KEY); formData.append("language", "eng"); formData.append("isOverlayRequired", "false"); formData.append("file", fileBlob, "image.jpg"); formData.append("OCREngine", "2"); formData.append("scale", "true"); formData.append("detectOrientation", "true"); try { const response = await fetch("https://api.ocr.space/parse/image", { method: "POST", body: formData }); const data = await response.json(); if (data.IsErroredOnProcessing) return null; if (data.ParsedResults && data.ParsedResults.length > 0) return data.ParsedResults[0].ParsedText; return ""; } catch (e) { return null; } }
        function displayInteractiveText(text) { resultCard.style.display = 'block'; resultContainer.style.display = 'block'; let formattedText = text.replace(/-\s*[\r\n]+/g, ""); formattedText = formattedText.replace(/\r\n/g, "\n"); formattedText = formattedText.replace(/\n\s*\n/g, "{{PARA}}"); formattedText = formattedText.replace(/\n/g, " "); formattedText = formattedText.replace(/{{PARA}}/g, "\n\n"); let cleanedText = formattedText.replace(/(\d+)/g, " $1 "); const paragraphs = cleanedText.split('\n\n'); paragraphs.forEach(paragraph => { if(paragraph.trim().length === 0) return; const paraDiv = document.createElement('div'); paraDiv.className = 'paragraph'; const words = paragraph.split(/(\s+)/); words.forEach(word => { const span = document.createElement('span'); span.innerText = word; const pureWord = word.replace(/[^a-zA-Z]/g, ""); if (pureWord.length > 0) { span.className = 'word'; span.onclick = () => { if (window.getSelection().toString().length > 0) return; lookupWord(pureWord); }; } paraDiv.appendChild(span); }); resultContainer.appendChild(paraDiv); }); }
        
        // æ¸¬é©—èˆ‡å–®å­—æœ¬ (V6.0 é‚è¼¯)
        function startQuiz() { if (savedVocab.length < 4) { alert("âš ï¸ å–®å­—æœ¬å…§çš„å–®å­—ä¸è¶³ 4 å€‹ï¼Œç„¡æ³•é€²è¡Œæ¸¬é©—ï¼"); return; } drawer.classList.remove('open'); uploadCard.style.display = 'none'; resultCard.style.display = 'none'; quizCard.style.display = 'block'; document.getElementById('quiz-game-area').style.display = 'block'; document.getElementById('quiz-result-area').style.display = 'none'; document.getElementById('quit-quiz-btn').style.display = 'inline-block'; quizQuestions = [...savedVocab].sort(() => 0.5 - Math.random()); if (quizQuestions.length > 10) quizQuestions = quizQuestions.slice(0, 10); currentQuestionIndex = 0; score = 0; document.getElementById('total-questions').innerText = quizQuestions.length; renderQuestion(); }
        function renderQuestion() { isAnswering = false; document.getElementById('current-score').innerText = score; const currentQ = quizQuestions[currentQuestionIndex]; document.getElementById('quiz-word').innerText = currentQ.word; const correctMeaning = currentQ.meaning; let distractors = savedVocab.filter(item => item.word !== currentQ.word).sort(() => 0.5 - Math.random()).slice(0, 3).map(item => item.meaning); let options = [correctMeaning, ...distractors].sort(() => 0.5 - Math.random()); const optionsContainer = document.getElementById('quiz-options'); optionsContainer.innerHTML = ''; options.forEach(opt => { const btn = document.createElement('button'); btn.className = 'quiz-btn'; btn.innerText = opt; btn.onclick = () => checkAnswer(btn, opt === correctMeaning); optionsContainer.appendChild(btn); }); speakWord(currentQ.word); }
        function checkAnswer(btn, isCorrect) { if (isAnswering) return; isAnswering = true; const buttons = document.querySelectorAll('.quiz-btn'); if (isCorrect) { btn.classList.add('correct'); score++; } else { btn.classList.add('wrong'); buttons.forEach(b => { if (b.innerText === quizQuestions[currentQuestionIndex].meaning) b.classList.add('correct'); }); } setTimeout(() => { currentQuestionIndex++; if (currentQuestionIndex < quizQuestions.length) renderQuestion(); else showQuizResult(); }, 1500); }
        function showQuizResult() { document.getElementById('quiz-game-area').style.display = 'none'; document.getElementById('quiz-result-area').style.display = 'block'; document.getElementById('quit-quiz-btn').style.display = 'none'; document.getElementById('current-score').innerText = score; const percentage = Math.round((score / quizQuestions.length) * 100); document.getElementById('final-score-title').innerText = `${percentage} åˆ†`; let comment = percentage === 100 ? "ğŸ† å¤ªç¥å•¦ï¼" : percentage >= 80 ? "âœ¨ éå¸¸æ£’ï¼" : "ğŸ’ª åŠ æ²¹ï¼"; document.getElementById('final-comment').innerText = comment; }
        
        async function lookupWord(text) { const queryText = text.replace(/[^a-zA-Z\s]/g, "").trim(); if(!queryText) return; modal.style.display = 'flex'; modalBody.innerHTML = `<div class="loader">ğŸ” æŸ¥è©¢ä¸­...</div>`; try { const [enResponse, zhResponse] = await Promise.all([ fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${queryText}`), fetch(`https://api.mymemory.translated.net/get?q=${queryText}&langpair=en|zh-TW`) ]); let enData = enResponse.ok ? await enResponse.json() : null; const zhData = await zhResponse.json(); let zhText = "ç¿»è­¯å¤±æ•—"; if (zhData && zhData.responseData) { let bestMatch = zhData.responseData.translatedText; if (!/[\u4e00-\u9fa5]/.test(bestMatch) && zhData.matches) { const better = zhData.matches.find(m => /[\u4e00-\u9fa5]/.test(m.translation)); if (better) bestMatch = better.translation; } zhText = bestMatch; } const isSaved = savedVocab.some(item => item.word.toLowerCase() === queryText.toLowerCase()); const starBtnText = isSaved ? 'â­ å·²æ”¶è—' : 'â˜† æ”¶è—'; const starBtnClass = isSaved ? 'btn-primary' : 'btn-outline'; let html = `<div style="display:flex; flex-wrap:wrap; align-items:center; gap:10px; border-bottom:1px solid #eee; padding-bottom:1rem; margin-bottom:1rem;"><h2 style="margin:0; color:var(--primary);">${queryText}</h2><button onclick="speakWord('${queryText}')" style="background:var(--success); color:white; border:none; border-radius:50%; width:32px; height:32px; cursor:pointer;">ğŸ”Š</button><div style="flex:1;"></div><button id="saveBtn" onclick="toggleSaveWord('${queryText}', '${zhText}')" class="action-btn ${starBtnClass}" style="width:auto; padding:0.4rem 1rem; margin:0;">${starBtnText}</button></div><div style="background:#fff7ed; padding:1rem; border-radius:0.5rem; border-left: 4px solid var(--warning); margin-bottom:1.5rem;"><strong style="font-size:1.2rem; color:var(--text-dark);">${zhText}</strong></div>`; if (Array.isArray(enData) && enData.length > 0) { const entry = enData[0]; entry.meanings.forEach(m => { html += `<div style="margin-bottom:1rem;"><span style="background:#eff6ff; color:var(--primary); padding:2px 8px; border-radius:4px; font-size:0.85rem; font-weight:bold;">${m.partOfSpeech}</span>`; m.definitions.slice(0,2).forEach((d,i) => { html += `<div style="margin:5px 0; display:flex;"><span style="color:var(--text-gray); margin-right:5px;">${i+1}.</span><span>${d.definition}</span></div>`; }); html += `</div>`; }); } else { html += `<p style="color:var(--text-gray);">(åƒ…ç¿»è­¯)</p>`; } modalBody.innerHTML = html; } catch (e) { modalBody.innerHTML = '<p>æŸ¥è©¢éŒ¯èª¤</p>'; } }
        function toggleSaveWord(word, meaning) { const index = savedVocab.findIndex(item => item.word.toLowerCase() === word.toLowerCase()); if (index === -1) { savedVocab.push({ word: word, meaning: meaning, date: new Date().toLocaleDateString() }); document.getElementById('saveBtn').innerText = 'â­ å·²æ”¶è—'; document.getElementById('saveBtn').className = 'action-btn btn-primary'; } else { savedVocab.splice(index, 1); document.getElementById('saveBtn').innerText = 'â˜† æ”¶è—'; document.getElementById('saveBtn').className = 'action-btn btn-outline'; } saveToLocalStorage(); updateVocabUI(); }
        function deleteWord(word) { savedVocab = savedVocab.filter(item => item.word !== word); saveToLocalStorage(); updateVocabUI(); }
        function clearVocab() { if(confirm('ç¢ºå®šæ¸…ç©ºï¼Ÿ')) { savedVocab = []; saveToLocalStorage(); updateVocabUI(); } }
        function saveToLocalStorage() { localStorage.setItem('myVocab', JSON.stringify(savedVocab)); }
        function updateVocabUI() { vocabCount.innerText = savedVocab.length; vocabList.innerHTML = ''; if (savedVocab.length === 0) { vocabList.innerHTML = '<div style="text-align:center; color:gray; margin-top:2rem;">ç„¡æ”¶è—å–®å­—</div>'; return; } [...savedVocab].reverse().forEach(item => { const div = document.createElement('div'); div.className = 'vocab-item'; div.innerHTML = `<div class="delete-btn" onclick="deleteWord('${item.word}')">&times;</div><div class="vocab-word" onclick="lookupWord('${item.word}')" style="cursor:pointer">${item.word}</div><div class="vocab-mean">${item.meaning}</div>`; vocabList.appendChild(div); }); }
        function exportToCSV() { if (savedVocab.length === 0) { alert('ç„¡è³‡æ–™'); return; } let csv = "\uFEFFå–®å­—,ä¸­æ–‡,æ—¥æœŸ\n"; savedVocab.forEach(i => csv += `${i.word},${i.meaning.replace(/,/g, "ï¼Œ")},${i.date}\n`); const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const link = document.createElement("a"); link.href = url; link.download = `Vocab_${new Date().toLocaleDateString()}.csv`; document.body.appendChild(link); link.click(); document.body.removeChild(link); }
        function speakWord(word) { const u = new SpeechSynthesisUtterance(word); u.lang = 'en-US'; window.speechSynthesis.speak(u); }
        function loadImage(file) { return new Promise((r, j) => { const img = new Image(); img.onload = () => r(img); img.onerror = j; img.src = URL.createObjectURL(file); }); }
        function cropImage(image, x, y, w, h) { return new Promise((resolve) => { const canvas = document.createElement('canvas'); const W = image.width * w; const H = image.height * h; const X = image.width * x; const Y = image.height * y; canvas.width = W; canvas.height = H; const ctx = canvas.getContext('2d'); ctx.fillStyle = "#FFFFFF"; ctx